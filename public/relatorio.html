<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relatórios de Produtos</title>
  <link rel="stylesheet" href="relatorio.css" />
</head>

<body>
  <div class="container">
    <h1>Relatórios de Produtos</h1>
    <div class="tabs">
      <button class="tab-button active" onclick="openTab('mais-vendidos', event)">Mais Vendidos</button>
      <!-- faça o mesmo para os outros botões -->

      <button class="tab-button" onclick="openTab('menos-vendidos', event)">Menos Vendidos</button>
      <button class="tab-button" onclick="openTab('estoque-atual', event)">Estoque Atual</button>

      <button class="tab-button" onclick="openTab('estoque-baixo')">Estoque Baixo</button>
      <button class="tab-button" onclick="openTab('fora-estoque')">Fora de Estoque</button>
      <button class="tab-button" onclick="openTab('vencidos')">Vencidos / Próximos</button>
      <button class="tab-button" onclick="openTab('lucro')">Lucro Unitário</button>
      <button class="tab-button" onclick="openTab('movimentacao')">Movimentação</button>
      <button class="tab-button" onclick="openTab('resumo')">Resumo Geral</button>
      <button class="tab-button" onclick="openTab('comparativo')">Comparativo</button>
    </div>

     <div class="tab-content active" id="mais-vendidos">
      <div class="report-section">
        <h2>Produtos Mais Vendidos</h2>
        <canvas id="graficoMaisVendidos" width="400" height="200"></canvas>
      </div>
    </div>

    <div class="tab-content" id="menos-vendidos">
      <div class="report-section">
        <h2>Produtos Menos Vendidos</h2>
        <canvas id="graficoMenosVendidos" width="400" height="200"></canvas>
      </div>
    </div>

    <div class="tab-content" id="estoque-atual">
      <div class="report-section">
        <h2>Estoque Atual</h2>
        <table id="tabelaEstoqueAtual">
          <thead>
            <tr>
              <th>Produto</th>
              <th>Categoria</th>
              <th>Quantidade Atual</th>
              <th>Estoque Mínimo</th>
            </tr>
          </thead>
          <tbody>
            <!-- Preenchido dinamicamente -->
          </tbody>
        </table>
      </div>
    </div>

    <div class="tab-content" id="estoque-baixo">
      <div class="report-section">
        <h2>Produtos com Estoque Baixo</h2>
        <p>Lista dos produtos com quantidade abaixo do estoque mínimo.</p>
        <!-- Conteúdo será inserido com JS -->
      </div>
    </div>

    <div class="tab-content" id="movimentacao">
      <div class="report-section">
        <h2>Movimentação de Produtos</h2>
        <p>Entradas e saídas detalhadas por período.</p>
        <!-- Conteúdo será inserido com JS -->
      </div>
    </div>
  </div>

<script>
  function openTab(tabId, event) {
    // Oculta todos os conteúdos
    document.querySelectorAll(".tab-content").forEach((tab) => {
      tab.classList.remove("active");
    });

    // Remove classe ativa de todos os botões
    document.querySelectorAll(".tab-button").forEach((btn) => {
      btn.classList.remove("active");
    });

    // Mostra aba selecionada
    document.getElementById(tabId).classList.add("active");
    event.target.classList.add("active");

    // Se precisar carregar dados, você pode chamar a função aqui
    if (tabId === "mais-vendidos") carregarMaisVendidos();
    if (tabId === "menos-vendidos") carregarMenosVendidos();
    if (tabId === "estoque-atual") carregarEstoqueAtual();
    if (tabId === "estoque-baixo") carregarEstoqueBaixo();
    if (tabId === "movimentacao") carregarMovimentacaoProdutos();
  }
</script>


  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Script para carregar os dados e gerar o gráfico -->
  <script>
    let chartInstance = null;

    async function carregarMaisVendidos() {
      const resposta = await fetch("/api/produtos/relatorios/mais-vendidos")

      const dados = await resposta.json();

      const nomes = dados.map(p => p.nome);
      const vendidos = dados.map(p => p.total_vendido);

      const ctx = document.getElementById("graficoMaisVendidos").getContext("2d");

      // Destroi gráfico anterior se existir
      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: nomes,
          datasets: [{
            label: "Quantidade Vendida",
            data: vendidos,
            backgroundColor: "#4caf50"
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: "Produtos Mais Vendidos"
            }
          }
        }
      });
    }

    async function carregarMenosVendidos() {
  const resposta = await fetch("/api/produtos/relatorios/menos-vendidos");

  const dados = await resposta.json();

  const nomes = dados.map(p => p.nome);
  const vendidos = dados.map(p => p.total_vendido);

  const ctx = document.getElementById("graficoMenosVendidos").getContext("2d");

  if (chartInstance) {
    chartInstance.destroy();
  }

  chartInstance = new Chart(ctx, {
    type: "bar",
    data: {
      labels: nomes,
      datasets: [{
        label: "Quantidade Vendida",
        data: vendidos,
        backgroundColor: "#f44336"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "Produtos Menos Vendidos"
        }
      }
    }
  });
}

async function carregarEstoqueAtual() {
  const resposta = await fetch("/api/produtos/relatorios/estoque-atual");
  const dados = await resposta.json();

  const tbody = document.querySelector("#tabelaEstoqueAtual tbody");
  tbody.innerHTML = "";

  dados.forEach(produto => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${produto.nome}</td>
      <td>${produto.categoria}</td>
      <td>${produto.quantidade_atual}</td>
      <td>${produto.estoque_minimo}</td>
    `;
    tbody.appendChild(tr);
  });
}





    function openTab(tabId, event) {
  document.querySelectorAll(".tab-content").forEach((tab) => {
    tab.classList.remove("active");
  });
  document.querySelectorAll(".tab-button").forEach((btn) => {
    btn.classList.remove("active");
  });
  document.getElementById(tabId).classList.add("active");
  event.target.classList.add("active");

  if (tabId === "mais-vendidos") {
    carregarMaisVendidos();
  } else if (tabId === "menos-vendidos") {
    carregarMenosVendidos();
  } else if (tabId === "estoque-atual") {
    carregarEstoqueAtual();
  }
}



    // Carrega o gráfico na primeira abertura da página
    window.addEventListener("DOMContentLoaded", () => {
      carregarMaisVendidos();
    });
  </script>

  

</body>

</html>